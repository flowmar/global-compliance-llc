//-
  @Author: flowmar
  @Date: 2022-07-02 23:11:25
  @Last Modified by:   flowmar
  @Last Modified time: 2022-07-02 23:11:25

extends layout.pug

block style
  style.
    .form-label{
    color: #fff;
    }


block content
  .container-fluid
    .row.mt-5
      .col-4.display-5.mx-5.page-title View Mariner
      .col-7
    .row.bg-dark.m-3.p-1.py-3
      .col.shadow-4-strong.bg-light.bg-opacity-25.p-4.d-flex.justify-content-evenly.m-2.mb-0
        .container
          .row.my-4
            .col-6
            .col-6.d-flex.justify-content-end.p-0
              #buttonDiv
                button.btn.mx-2#appModalButton(data-mdb-target="#applicationModal" style="background-color: var(--yellow-color);" value="Application")
                  i.bi.bi-file-medical(style="font-size: 1rem;")
                  span   &nbsp;Application
                button.btn.mx-2(type="button" style="background-color: var(--yellow-color);" value="Print" onclick="downloadMarinerPDF()")
                  i.bi.bi-printer(style="font-size: 1rem;")
                  span   &nbsp;Print
                a.btn.mx-1(id="licenses-button" data-mdb-target="#licensesModal" type="button" href='/licenses' style="background-color: var(--yellow-color);" value="Licenses" target="_blank")
                  i.bi.bi-credit-card(style="font-size: 1rem;")
                  span   &nbsp;Licenses
            br
          .row
            .col
              .display-5.fw-bold Mariner Information
          hr.mt-1
          .row.my-4
            .col-3
              label.form-label(for="mariner-id") Mariner ID:
              input.form-control(id="mariner-id" name="marinerID" type="text" style="background-color: var(--highlight-bg-color);" value="" disabled)
              input.form-control(id="marinerIDHidden" hidden)
            .col-6
            .col-3
              label.form-label(for="application-id") Application ID:
              input.form-control(id="application-id" name="applicationID" type="text" style="background-color: var(--highlight-bg-color);" value="" disabled)
          .row.my-4
            .col-4
              label.form-label(for="first-name") First Name:
              input.form-control.bg-white(id="first-name" name="firstName" data-parsley-required="true" type="text" disabled)
            .col-4
              label.form-label(for="middle-name") Middle Name:
              input.form-control.bg-white(id="middle-name" name="middleName" type="text" disabled)
            .col-4
              label.form-label(for="last-name") Last Name:
              input.form-control.bg-white(id="last-name" name="lastName" data-parsley-required="true" type="text" disabled)
          .row.my-4
              .col-3
                label.form-label(for="height") Height:
                input.form-control.bg-white(id="height" name="height" type="text" disabled)
              .col-3
                label.form-label(for="weight") Weight:
                input.form-control.bg-white(id="weight" name="weight" type="text" disabled)
              .col-3
                label.form-label(for="hairColor") Hair Color:
                input.form-control.bg-white(id="hairColor" name="hair" type="text" disabled)
              .col-3
                label.form-label(for="eyeColor") Eye Color:
                input.form-control.bg-white(id="eyeColor" name="eyeColor" data-parsley-required="false" type="text" disabled)
          .row.my-4
            .col-3
              label.form-label(for="birth-city") City of Birth:
              input.form-control.bg-white(id="birth-city" name="birthCity" type="text" disabled)
            .col-3
              label.form-label(for="birth-state") State of Birth:
              input.form-control.bg-white(id="birth-state" name="birthState" type="text" disabled)
            .col-3
              label.form-label(for="birth-country") Country of Birth:
              select.form-select.bg-white(id="birth-country" name="birthCountry" aria-label="Select birth country" disabled)
            .col-3
              label.form-label(for="birth-date") Birth Date:
              input.form-control.bg-white.text-dark(id="birth-date" name="birthDate" data-parsley-required="true" type="date" disabled)
          .row.my-4
            .col-4
              label.form-label(for="marks") Distinguishing Marks:
              input.form-control.bg-white(id="marks" name="marks" disabled)
            .col-4
              label.form-label(for="physLocation") Physical Location:
              input.form-control.bg-white.text-dark(id="physLocation" name="physLocation" disabled)
            .col-4
              label.form-label(for="physDate") Date of Physical:
              input.form-control.bg-white(id="physDate" name="physDate" data-parsley-required="false" type="date" disabled)
          .row.my-3
          hr
          .row.my-4
            .col-7
                label.form-label(for="address") Street Address:
                input.form-control.bg-white(id="address" name="address" type="text" disabled)
            .row.my-4
              .col-3
                label.form-label(for="city") City:
                input.form-control.bg-white(id="city" name="city" type="text" disabled)
              .col-1
              .col-3
                label.form-label(for="state") State:
                input.form-control.bg-white(id="state" name="state" type="text" disabled)
              .col-1
              .col-3
                label.form-label(for="zip-code") Zip Code:
                input.form-control.bg-white(id="zip-code" name="zipCode" type="text" disabled)
            .row.my-4
              .col-4
                label.form-label(for="country") Country:
                input.form-control.bg-white(id="country" name="country" type="text" disabled)
            .row.my-4
              .col-3
                label.form-label(for="phone-number") Mobile Number:
                input.form-control.bg-white(id="phone-number" name="phone" type="tel" onkeydown="phoneNumberFormatter()" disabled)
              .col-1
              .col-3
                label.form-label(for="home-phone") Home Number:
                input.form-control.bg-white(id="home-phone" name="homePhone" type="tel" onkeydown="homePhoneNumberFormatter()" disabled)
              .col-1
              .col-4
                label.form-label(for="email") Email:
                input.form-control.bg-white(id="email" name="email" data-parsley-required="false" type="email" disabled)
            .row.my-4
              .col-4
                label.form-label(for="passport-number") Passport Number:
                input.form-control.bg-white(id="passport-number" name="passportNumber" data-parsley-type="digits" type="text" disabled)
              .col-4
                label.form-label(for="citizenship") Citizenship:
                select.form-select.bg-white(id="citizenship" name="citizenship" aria-label="Select citizenship" disabled)
            hr.my-4.mt-5
            .row.mb-2
              .col-4
                label.form-label(for="employer") Employer:
                select.form-select.bg-white(id="employer" name="employer" disabled)
                  option(value)
              .col-4
                label.form-label(for="vessel-name") Rig:
                input.form-control.bg-white(id="vessel-name" name="vessel" type="text" disabled)
          .row.my-4
            .col-4
              label.form-label(for="mariner-reference-number") Mariner Reference Number:
              input.form-control.bg-white(id="mariner-reference-number" name="marinerRefNum" data-parsley-type="digits" type="text" disabled)
          .row.my-4
              .col-4
                label.form-label(for="coContact") Co. Contact:
                input.form-control.bg-white(id="coContact" name="coContact" type="text" disabled)
              .col-4
                label.form-label(for="imoNumber") IMO Number:
                input.form-control.bg-white(id="imoNumber" name="imoNumber" data-parsley-type="digits" type="text" disabled)
          .row.my-4
            .col-4
              label.form-label(for="processing-agent") Processing Agent:
              select.form-select.bg-white.text-dark(id="processing-agent" name="processingAgent" disabled)
            .col-4
            .col-4
              label.form-label(for="status") Status:
              select.form-select.bg-white.text-dark(id="status" name="status" disabled)
                option(value="0")
                option(value="1") Pending
                option(value="2") Submitted
                option(value="3") Completed
          br
          .container-fluid.p-0
            .row
              .col
                .display-5.fw-bold Mariner Notes
            hr
            .row.mt-3.position-relative
              .col
                table.table.table-bordered.table-sm#activityTable
                  thead.table-dark
                    tr.text-center
                      th(scope="col") Date
                      th(scope="col") Activity
                      th(scope="col") Agent
                  tbody.bg-white.text-dark.table-group-divider.table-divider-color(style="font-size: 1rem; font-weight: bold;")#activityTableBody
          .row.my-4
            .col
            .col.d-flex.justify-content-end
              //- button.btn.btn-lg.m-2.text-dark(style="background-color: var(--green-color); color:#4f4f4f" type="submit" id="save-mariner" value="Save")
              //-   i.bi.bi-save(style="font-size=.9rem")
              //-   span    &nbsp;Save

  include includes/viewApplicationModal

  script.
    let marinerObject = !{JSON.stringify(viewMariner)};
    console.log(marinerObject);
    console.log(marinerObject['MarinerID']);
    let viewMarinerID = marinerObject['MarinerID'];
    console.log(viewMarinerID);

    let countriesArray = !{JSON.stringify(countries)};
    let agentsArray = !{JSON.stringify(agents)};
    let employersArray = !{JSON.stringify(employers)};
    let activitiesArray = !{JSON.stringify(activities)};
    let rigsArray = !{JSON.stringify(rigs)};
    console.log(rigsArray);
    let marinerHidden = $('#marinerIDHidden');
    console.log(marinerHidden);
    marinerHidden.attr("value", viewMarinerID);

    //- Wait until DOM is loaded
    window.addEventListener('DOMContentLoaded', (event) => {
      let citizenshipInput = document.getElementById('citizenship');
    let birthCountryInput = document.getElementById('birth-country');
    let employerInput = document.getElementById('employer');
    let agentInput = document.getElementById('processing-agent');

      for(let i = 0; i < countriesArray.length; i++) {

      let element = document.createElement('option');
      element.value = i + 1;
      element.text = countriesArray[i]['CountryName'];
      citizenshipInput.appendChild(element);

      let element2 = document.createElement('option');
      element2.value = i + 1;
      element2.text = countriesArray[i]['CountryName'];
      birthCountryInput.appendChild(element2);
    }

    //- Create option elements for Employers
    for(k = 0; k  < employersArray.length; k++) {
      let element3 = document.createElement('option');
      element3.value= employersArray[k]["EmployerID"];
      element3.text = employersArray[k]["EmployerID"] + " - " + employersArray[k]["EmployerName"];
      employerInput.appendChild(element3);
    }

    //- Create option elements for Agents
    for(l = 0; l < agentsArray.length; l++) {
      let element4 = document.createElement('option');
      element4.value = agentsArray[l]["AgentID"];
      element4.text = agentsArray[l]["AgentName"];
      agentInput.appendChild(element4);
    }

    // Place the values from the mariner object into the UI
    let marinerIDArea = $('#mariner-id');
    marinerIDArea.val(viewMarinerID);
    $('#application-id').val(marinerObject['ApplicationID']);
    $('#first-name').val(marinerObject['FirstName']);
    $('#last-name').val(marinerObject['LastName']);
    $('#middle-name').val(marinerObject['MiddleName']);
    $('#address').val(marinerObject['StreetAddress']);
    $('#phone-number').val(marinerObject['PhoneNumber']);
    $('#email').val(marinerObject['Email']);
    $('#employer').val(marinerObject['EmployerID']);

    // Use the EmployerID to find the appropriate rigs in the rigsArray
    for (let rigObject of rigsArray){

      if (rigObject.RigID == marinerObject['RigID'])
      {
        $('#vessel-name').val(rigObject['RigName']);
      }
    }
    $('#mariner-reference-number').val(marinerObject['MarinerReferenceNumber']);
    $('#passport-number').val(marinerObject['PassportNumber']);
    $('#citizenship').val(marinerObject['Citizenship']);
    $('#birth-city').val(marinerObject['BirthCity']);
    $('#birth-state').val(marinerObject['BirthState']);
    $('#birth-country').val(marinerObject['BirthCountry']);
    let dateString = marinerObject['BirthDate'].toString();
    console.log(dateString);
    console.log(dateString.slice(0, 10));
    let birthDate = dateString.slice(0, 10);
    $('#birth-date').val(birthDate);
    $('#processing-agent').val(marinerObject['ProcessingAgent']);
    $('#status').val(marinerObject['Status']);
    $('#height').val(marinerObject['Height']);
    $('#weight').val(marinerObject['Weight']);
    $('#hairColor').val(marinerObject['HairColor']);
    $('#eyeColor').val(marinerObject['EyeColor']);
    $('#marks').val(marinerObject['Marks']);
    $('#physLocation').val(marinerObject['PhysLocation']);
    let physDateString = marinerObject['PhysDate'].toString();
    let physDate = physDateString.slice(0, 10);
    $('#physDate').val(physDate);
    $('#coContact').val(marinerObject['CoContact']);
    $('#imoNumber').val(marinerObject['IMONum']);
    $('#city').val(marinerObject['City']);
    $('#state').val(marinerObject['State']);
    $('#zip-code').val(marinerObject['ZipCode']);
    $('#country').val(marinerObject['Country']);
    $('#home-phone').val(marinerObject['HomePhone']);





    // Place the activity information into the UI
    let activityTableBody = $('#activityTableBody');
    console.log(activitiesArray);
    for (let activity of activitiesArray){

    // Format the Date
    let formattedDate = new Date(activity['ActivityDate']).toString();
    formattedDateArray = formattedDate.split(' ');
    formattedDate = formattedDateArray[1] + ' ' + formattedDateArray[2] + ' ' + formattedDate[3] + ' ' + formattedDateArray[4];

    // Create the table row
    let tableRow = document.createElement('tr');
    tableRow.dataset.activityid = activity['ActivityID'];
    tableRow.dataset.marinerid = activity['MarinerID'];
    tableRow.dataset.activity = activity['ActivityNote'];
    tableRow.dataset.processingAgent = activity['ProcessingAgent'];
    tableRow.style = "text-align: center;";

    // Add the cells
    tableRow.innerHTML = "<td id='" + activity['ActivityID']  + "' data-mariner-id='" + activity['MarinerID'] + "'>" + formattedDate + "</td><td>" + activity['ActivityNote'] + "</td><td>" + activity['ProcessingAgent'] + "</td>";
    // Append to the table
    activityTableBody.append(tableRow);

    }
    });
  script(src="/js/view.js")
